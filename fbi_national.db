# populate_databases.py
import sqlite3
import os
from dentist_codes import dentist_codes  # tu módulo con los códigos

BASE_DIR = os.path.dirname(os.path.abspath(__file__))

# Nombres de las bases
DB_LOCAL = os.path.join(BASE_DIR, "cost_estimates.db")
DB_FBI = os.path.join(BASE_DIR, "fbi_national.db")

def create_db(db_path, table_name="cost_estimates"):
    """Crea una base de datos y la tabla principal si no existe"""
    conn = sqlite3.connect(db_path)
    cursor = conn.cursor()
    cursor.execute(f"""
        CREATE TABLE IF NOT EXISTS {table_name} (
            id INTEGER PRIMARY KEY AUTOINCREMENT,
            cpt_code TEXT,
            description TEXT,
            state TEXT,
            zip_code TEXT,
            low_price REAL,
            high_price REAL
        )
    """)
    conn.commit()
    conn.close()
    print(f"[OK] Base creada: {db_path}")

def populate_db(db_path, table_name="cost_estimates"):
    """Inserta todos los códigos de dentist_codes.py en la base"""
    conn = sqlite3.connect(db_path)
    cursor = conn.cursor()
    for code, desc, state, zip_code, low, high in dentist_codes:
        cursor.execute(f"""
            INSERT INTO {table_name} (cpt_code, description, state, zip_code, low_price, high_price)
            VALUES (?, ?, ?, ?, ?, ?)
        """, (code, desc, state, zip_code, low, high))
    conn.commit()
    conn.close()
    print(f"[OK] Datos insertados en {db_path}")

if __name__ == "__main__":
    # Crear y poblar base local
    create_db(DB_LOCAL, table_name="cost_estimates")
    populate_db(DB_LOCAL, table_name="cost_estimates")

    # Crear y poblar base nacional (FBI)
    create_db(DB_FBI, table_name="fbi_cost_estimates")
    populate_db(DB_FBI, table_name="fbi_cost_estimates")

    print("[LISTO] Bases locales y nacionales creadas con datos de dentist_codes.py")
