<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AURA by May Roga LLC</title>
<style>
body { font-family: 'Segoe UI', Arial; background: #000; color: #fff; margin: 0; text-align: center; }
.marquee { background: #001a33; border-bottom: 2px solid #00d4ff; overflow: hidden; white-space: nowrap; padding: 15px 0; }
.marquee-content { display: inline-block; animation: scroll 35s linear infinite; color: #00d4ff; font-weight: 900; font-size: 1.2rem; }
@keyframes scroll { from { transform: translateX(0); } to { transform: translateX(-50%); } }
.container { max-width: 900px; margin: auto; padding: 25px; border: 3px solid #00d4ff; border-radius: 40px; background: #080808; margin-top: 10px; }
.yellow { color: #ffff00; font-weight: bold; font-size: 1.5rem; }
.search-hero { font-size: 1.3rem; color: #00d4ff; font-weight: bold; margin: 20px 0; border: 1px dashed #00d4ff; padding: 20px; border-radius: 20px; line-height: 1.5; }
.plan-card { border: 2px solid #00d4ff; border-radius: 20px; padding: 15px; margin: 10px; display: inline-block; width: 28%; vertical-align: top; background: #0a0a0a; }
.btn-pay { background: #00d4ff; color: #000; border: none; padding: 15px; border-radius: 12px; font-weight: bold; cursor: pointer; width: 100%; font-size: 1.1rem; transition: 0.3s; }
input { padding: 18px; border-radius: 15px; border: 2px solid #00d4ff; background: #000; color: #fff; margin: 10px; font-size: 1.2rem; width: 100%; box-sizing: border-box; }
.res-box { text-align: left; padding: 25px; border: 1px dashed #00d4ff; background: #050505; margin-top: 25px; font-size: 1.1rem; line-height: 1.6; white-space: pre-wrap; display: none; }
.donacion-box { border: 5px solid #ffff00; border-radius: 35px; padding: 30px; margin-top: 40px; }
.btn-donar { background: #ffff00; color: #000; border: none; padding: 20px; border-radius: 15px; font-weight: 900; width: 100%; cursor: pointer; font-size: 1.6rem; }
.btn-ex { padding: 12px; border-radius: 10px; border: none; font-weight: bold; cursor: pointer; margin: 5px; color: white; }
.clear-btn { position: absolute; right: 15px; top: 50%; transform: translateY(-50%); background: #333; color: #00d4ff; border: 1px solid #00d4ff; border-radius: 8px; padding: 5px 10px; cursor: pointer; font-size: 0.8rem; }
#geo-txt { color: #ffff00; font-size: 0.9rem; margin-bottom: 10px; font-weight: bold; }
.login-box { margin: 20px auto; padding: 20px; border: 2px solid #00d4ff; border-radius: 25px; max-width: 400px; background: #0a0a0a; }
.login-box input { width: 80%; margin: 10px auto; display: block; }
.login-box button { width: 85%; }
.lang-box { margin-bottom: 20px; }
</style>
</head>
<body>

<div class="marquee">
  <div class="marquee-content" id="marquee-text">
    üõ°Ô∏è AURA BY MAY ROGA LLC: ESTIMADOS DE PRECIOS M√âDICOS PARA CONSUMIDORES ‚Ä¢ TRANSPARENCIA TOTAL ‚Ä¢ NO SOMOS M√âDICOS NI ASEGURADORAS ‚Ä¢ SOLO INFORMACI√ìN DE MERCADO ‚Ä¢
  </div>
</div>

<div class="container">
<h1 style="color: #00d4ff; font-size: 4rem; margin: 0;" id="title-aura">AURA</h1>
<div class="yellow" id="subtitle-aura">by May Roga LLC</div>

<div class="search-hero" id="search-hero">
CONSULTA ESTIMADOS DE PRECIOS M√âDICOS Y DENTALES EN USA.<br>
Introduce procedimiento, s√≠ntoma, c√≥digo o ubicaci√≥n. Obt√©n rango de mercado y precio justo.
</div>

<div class="lang-box">
  <button class="btn-ex" style="background:#00d4ff; color:#000;" onclick="changeLang('es')">ESPA√ëOL</button>
  <button class="btn-ex" style="background:#fff; color:#000;" onclick="changeLang('en')">ENGLISH</button>
</div>

<div class="login-box">
  <input type="text" id="admin-user" placeholder="Usuario Admin (Opcional)">
  <input type="password" id="admin-pass" placeholder="Contrase√±a Admin">
  <button class="btn-pay" onclick="loginAdmin()" id="login-btn">ACCEDER GRATIS</button>
</div>

<div id="paywall">
  <div class="plan-card"><h4 class="plan-title">C. R√ÅPIDA</h4><p class="plan-price">$5.99</p><button class="btn-pay" onclick="pagar('rapido')" id="pay-rapido">PAGAR ACCESO</button></div>
  <div class="plan-card"><h4 class="plan-title">STANDARD</h4><p class="plan-price">$9.99</p><button class="btn-pay" onclick="pagar('standard')" id="pay-standard">PAGAR ACCESO</button></div>
  <div class="plan-card"><h4 class="plan-title">ESPECIAL</h4><p class="plan-price">$19.99</p><button class="btn-pay" onclick="pagar('special')" id="pay-special">PAGAR ACCESO</button></div>
</div>

<div id="sistema-aura" style="display:none;">
  <div id="geo-txt">üìç Detectando ubicaci√≥n para precisi√≥n...</div>

  <button onclick="listen()" style="font-size:5rem; background:none; border:none; cursor:pointer;">üé§</button>
  <div style="position:relative; width:85%; margin:auto;">
    <input type="text" id="q" placeholder="Procedimiento, s√≠ntoma o c√≥digo (ej: MRI, D2750)">
    <button class="clear-btn" onclick="document.getElementById('q').value=''">‚úñ BORRAR</button>
  </div>
  <button class="btn-pay" onclick="getEstimate()" style="font-size:1.8rem; margin-top:20px; width:85%;" id="estimate-btn">REVELAR ESTIMADO DE PRECIO</button>
  <div id="res" class="res-box"></div>

  <div id="export-bar" style="display:none; margin-top:20px;">
    <button class="btn-ex" style="background:#25d366;" onclick="shareWA()" id="wa-btn">WhatsApp üõ°Ô∏è</button>
    <button class="btn-ex" style="background:#ffff00; color:#000;" onclick="readOut()" id="read-btn">üîä Escuchar</button>
    <button class="btn-ex" style="background:#ff9500; color:#000;" onclick="exportPDF()" id="pdf-btn">üñ®Ô∏è PDF / Print</button>
  </div>
</div>

<div class="donacion-box">
  <h2 style="color:#ffff00; margin-top:0;" id="donation-title">ü§ù FONDO DE SOLIDARIDAD Y EMPLEO</h2>
  <button class="btn-donar" onclick="pagar('donacion')" id="don-btn">REALIZAR DONACI√ìN VOLUNTARIA</button>
</div>
</div>

<script>
let currentLang = 'es';
let userZip = null;

// GEO AUTOM√ÅTICO
function getGeo() {
  if(navigator.geolocation){
    navigator.geolocation.getCurrentPosition(async pos=>{
      const { latitude, longitude } = pos.coords;
      try {
        const r = await fetch(`https://api.bigdatacloud.net/data/reverse-geocode-client?latitude=${latitude}&longitude=${longitude}&localityLanguage=${currentLang}`);
        const data = await r.json();
        userZip = data.postcode || null;
        document.getElementById('geo-txt').innerText = userZip ? 
          (currentLang==='es'?`üìç Ubicaci√≥n detectada: ZIP ${userZip}`:`üìç Location detected: ZIP ${userZip}`) : 
          (currentLang==='es'? "üìç Ubicaci√≥n: USA General":"üìç Location: USA General");
      } catch {
        document.getElementById('geo-txt').innerText = currentLang==='es'? "üìç Ubicaci√≥n: USA General":"üìç Location: USA General";
      }
    });
  } else { 
    document.getElementById('geo-txt').innerText = currentLang==='es'? "üìç Ubicaci√≥n no disponible":"üìç Location not available"; 
  }
}

window.onload = () => {
  getGeo();
  if(new URLSearchParams(window.location.search).has('success')) {
    document.getElementById('paywall').style.display='none';
    document.getElementById('sistema-aura').style.display='block';
  }
};

// ESTIMADO
async function getEstimate() {
  const q = document.getElementById('q').value.trim();
  if(!q && !userZip) return;
  const resDiv = document.getElementById('res');
  resDiv.style.display='block';
  resDiv.innerHTML=currentLang==='es'? "<h2 style='color:#ffff00;'>Aura analizando mercado...</h2>" : "<h2 style='color:#ffff00;'>Aura analyzing market...</h2>";

  const fd = new FormData();
  fd.append("consulta", q);
  fd.append("lang", currentLang);
  if(userZip) fd.append("zip_user", userZip);

  try {
    const r = await fetch("/estimado",{method:"POST", body:fd});
    const d = await r.json();
    resDiv.innerText = d.resultado;
    document.getElementById('export-bar').style.display='block';
  } catch { 
    resDiv.innerText = currentLang==='es'? "Error de conexi√≥n." : "Connection error.";
  }
}

// IDIOMA
function changeLang(lang){ 
  currentLang = lang;
  document.getElementById('q').placeholder = lang==='es' ? "Procedimiento o s√≠ntoma..." : "Procedure or symptom...";
  document.getElementById('search-hero').innerText = lang==='es' ? 
    "CONSULTA ESTIMADOS DE PRECIOS M√âDICOS Y DENTALES EN USA.\nIntroduce procedimiento, s√≠ntoma, c√≥digo o ubicaci√≥n. Obt√©n rango de mercado y precio justo." :
    "CHECK ESTIMATED MEDICAL AND DENTAL PRICES IN USA.\nEnter procedure, symptom, code or location. Get market range and fair price.";
  document.getElementById('marquee-text').innerText = lang==='es' ?
    "üõ°Ô∏è AURA BY MAY ROGA LLC: ESTIMADOS DE PRECIOS M√âDICOS PARA CONSUMIDORES ‚Ä¢ TRANSPARENCIA TOTAL ‚Ä¢ NO SOMOS M√âDICOS NI ASEGURADORAS ‚Ä¢ SOLO INFORMACI√ìN DE MERCADO ‚Ä¢" :
    "üõ°Ô∏è AURA BY MAY ROGA LLC: MEDICAL PRICE ESTIMATES FOR CONSUMERS ‚Ä¢ TOTAL TRANSPARENCY ‚Ä¢ NOT DOCTORS OR INSURANCE ‚Ä¢ MARKET INFO ONLY ‚Ä¢";
  document.getElementById('login-btn').innerText = lang==='es'? "ACCEDER GRATIS":"FREE ACCESS";
  document.getElementById('estimate-btn').innerText = lang==='es'? "REVELAR ESTIMADO DE PRECIO":"SHOW ESTIMATE";
  document.getElementById('donation-title').innerText = lang==='es'? "ü§ù FONDO DE SOLIDARIDAD Y EMPLEO":"ü§ù SOLIDARITY & EMPLOYMENT FUND";
  document.getElementById('don-btn').innerText = lang==='es'? "REALIZAR DONACI√ìN VOLUNTARIA":"MAKE VOLUNTARY DONATION";
}

// VOZ
function listen(){
  try{
    const rec = new (window.SpeechRecognition||window.webkitSpeechRecognition)();
    rec.lang = currentLang==='es'?'es-US':'en-US';
    rec.onresult = e=>{document.getElementById('q').value = e.results[0][0].transcript;};
    rec.start();
  } catch { alert(currentLang==='es'?"Reconocimiento de voz no soportado en este navegador.":"Speech recognition not supported in this browser."); }
}

// PAGO STRIPE / DONACION
async function pagar(plan){
  if(plan==='donacion'){ window.location.href="https://buy.stripe.com/28E00igMD8dR00v5vl7Vm0h"; return; }
  const fd=new FormData();
  fd.append("plan", plan);
  try {
    const res=await fetch("/create-checkout-session",{method:"POST",body:fd});
    const data=await res.json();
    if(data.url) window.location.href=data.url;
  } catch { alert(currentLang==='es'? "Error al conectar con Stripe.":"Error connecting to Stripe."); }
}

// LOGIN ADMIN / GRATIS
async function loginAdmin(){
  const user = document.getElementById('admin-user').value.trim();
  const pw = document.getElementById('admin-pass').value.trim();
  if(!user || !pw) return alert(currentLang==='es'? "Ingresa usuario y contrase√±a.":"Enter username and password.");
  const fd = new FormData();
  fd.append("user", user);
  fd.append("pw", pw);
  try {
    const res = await fetch("/login-admin", {method:"POST", body:fd});
    if(res.status===200){
      document.getElementById('paywall').style.display='none';
      document.getElementById('sistema-aura').style.display='block';
      alert(currentLang==='es'? "Acceso gratuito concedido.":"Free access granted.");
    } else { alert(currentLang==='es'? "Usuario o contrase√±a incorrectos.":"Incorrect username or password."); }
  } catch { alert(currentLang==='es'? "Error de conexi√≥n.":"Connection error."); }
}

// LEER
function readOut(){
  const ut = new SpeechSynthesisUtterance(document.getElementById('res').innerText);
  ut.lang = currentLang==='es'?'es-US':'en-US';
  window.speechSynthesis.speak(ut);
}

// WHATSAPP
function shareWA(){
  window.open("https://wa.me/?text="+encodeURIComponent(document.getElementById('res').innerText));
}

// PDF / PRINT
function exportPDF(){
  const content = document.getElementById('res').innerText;
  const myWindow = window.open('', '', 'width=800,height=600');
  myWindow.document.write('<pre style="font-family:Arial; white-space:pre-wrap;">'+content+'</pre>');
  myWindow.document.close();
  myWindow.print();
}
</script>
</body>
</html>
